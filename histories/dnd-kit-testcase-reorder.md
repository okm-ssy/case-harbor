# テストケースのドラッグ&ドロップ並び替え機能

## 実装方針

@dnd-kit/core と @dnd-kit/sortable を使用してテストケースの直感的な並び替え機能を実装。既存のテーブル構造を保持しつつ、各行にドラッグハンドルを追加してユーザビリティを向上させた。

## 実装内容

### 1. 依存関係の追加
- `@dnd-kit/core`: ドラッグ&ドロップの基本機能
- `@dnd-kit/sortable`: ソート可能なリスト機能  
- `@dnd-kit/utilities`: CSS変換ユーティリティ

### 2. 定数の追加 (ui.ts)
- `DRAG_HANDLE_WIDTH`: ドラッグハンドルの幅
- `DRAG_HANDLE_OPACITY`: ドラッグハンドルの透明度
- `DRAG_OVERLAY_OPACITY`: ドラッグ中のオーバーレイ透明度
- `BUTTONS.DRAG_HANDLE`: ドラッグハンドルアイコン（⋮⋮）

### 3. TestCaseTable.tsx の主要変更

#### コンポーネント分離
- `SortableTestCaseRow`: ドラッグ可能なテーブル行コンポーネントとして分離
- useSortable フックでドラッグ&ドロップ機能を実装

#### ドラッグ&ドロップ機能
- `DndContext`: 全体のドラッグ&ドロップ文脈を提供
- `SortableContext`: ソート可能なアイテムのコンテナ
- `DragOverlay`: ドラッグ中の視覚フィードバック

#### ドラッグハンドル
- IDカラムにドラッグハンドル（⋮⋮）を追加
- ハンドル部分のみでドラッグ操作を可能にし、テキスト編集を阻害しない設計

### 4. App.tsx の変更

#### 並び替えハンドラーの追加
- `handleReorderTestCases`: ドラッグ&ドロップによる並び替え処理
- 楽観的更新でUI即座更新
- `/api/testcases/reorder` エンドポイントへのAPI呼び出し

#### TestCaseTable への Props 追加
- `onReorder` プロパティを追加してコンポーネント間の通信を実現

## 技術的特徴

### 楽観的更新
- ドラッグ&ドロップ時に即座にUI更新
- API失敗時は自動的に元の状態に復旧

### アクセシビリティ
- キーボードセンサーによるキーボード操作対応
- ドラッグハンドルにtitle属性でツールチップ表示

### 既存機能との共存
- テキスト編集機能は維持
- Tab ナビゲーション機能は維持
- 自動テストケース追加機能は維持

## 操作方法

1. IDカラムの⋮⋮アイコンをクリック・ドラッグ
2. 目的の位置でドロップ
3. キーボード操作も対応（アクセシビリティ）

バックエンドAPI `/api/testcases/reorder` の実装が必要。